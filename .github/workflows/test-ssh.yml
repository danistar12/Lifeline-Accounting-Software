name: Test SSH Connection

on:
  workflow_dispatch: # Manual trigger only

jobs:
  test-connection:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Test SSH connection to server
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SSH_USER }}
        password: ${{ secrets.SERVER_PASSWORD }}
        timeout: 30s
        script: |
          echo "üîç Testing SSH connection..."
          echo "Server: $(hostname)"
          echo "User: $(whoami)"
          echo "Date: $(date)"
          echo "Working directory: $(pwd)"
          echo "Available space: $(df -h /var/www)"
          echo "Project directory exists: $([[ -d /var/www/lifeline-accounting ]] && echo 'YES' || echo 'NO')"
          
          if [[ -d /var/www/lifeline-accounting ]]; then
            echo "Project directory contents:"
            ls -la /var/www/lifeline-accounting/
            
            echo "Git status:"
            cd /var/www/lifeline-accounting
            git status --porcelain || echo "Not a git repository or git error"
            
            echo "Backend venv exists: $([[ -d backend/venv ]] && echo 'YES' || echo 'NO')"
            echo "Frontend node_modules exists: $([[ -d frontend/node_modules ]] && echo 'YES' || echo 'NO')"
            echo "Frontend package.json exists: $([[ -f frontend/package.json ]] && echo 'YES' || echo 'NO')"
          fi
          
          echo "‚úÖ SSH connection test completed!"